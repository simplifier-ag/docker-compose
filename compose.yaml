include:
  - path: include/include.yaml
    project_directory: include

services:

  mysql:
    image: mysql:8.0
    container_name: mysql
    volumes:
      - ${HOST_DATA_PATH}/mysql:/var/lib/mysql
    restart: always
    command: --max_allowed_packet=1073741824 --wait_timeout=28800 --default-authentication-plugin=caching_sha2_password --log_bin_trust_function_creators=1 --expire-logs-days=7
    environment:
      - MYSQL_ROOT_PASSWORD=${DB_ROOT_PASSWORD}
    healthcheck:
      test: ["CMD", "mysqladmin" ,"ping", "-h", "localhost", "-u", "root", "--password=${DB_ROOT_PASSWORD}"]
      interval: 5s
      timeout: 2s
      retries: 0
      start_period: 5s
    networks:
      - internal-network

  traefik_nossl:
    image: traefik:2.11.2
    restart: always
    container_name: traefik
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /usr/share/zoneinfo:/usr/share/zoneinfo:ro
      - ${HOST_DATA_PATH}/traefik/:/configuration/
    environment:
      - TZ=Europe/Berlin
    command:
      - --entrypoints.web.address=:80
      - --entrypoints.debugging.address=:${DEBUG_CHROME_DEV_TOOLS_EXPOSED_PORT}

      #Should the timeouts be too short for the debugging, then they can be increased here.
      - --entryPoints.debugging.transport.respondingTimeouts.readTimeout=60
      - --entryPoints.debugging.transport.respondingTimeouts.idleTimeout=180

      - --providers.docker=true
      - --providers.docker.exposedbydefault=false
      - --providers.docker.network=public-network
      - --providers.file.directory=/configuration/
      - --providers.file.watch=true
      - --accesslog
      - --accesslog.fields.names.StartUTC=drop
    ports:
      - ${DEBUG_CHROME_DEV_TOOLS_EXPOSED_PORT}:2992
      - ${PUBLIC_PORT_HTTP}:80
    networks:
      - internal-network
      - public-network

#   traefik:
#     image: traefik:2.11.2
#     restart: always
#     container_name: traefik
#     volumes:
#       - /var/run/docker.sock:/var/run/docker.sock:ro
#       - /usr/share/zoneinfo:/usr/share/zoneinfo:ro
#       - ${HOST_DATA_PATH}/traefik/:/configuration/
#     environment:
#       - TZ=Europe/Berlin
#     command:
#       - --entrypoints.web.address=:80
#       - --entrypoints.web.http.redirections.entrypoint.to=websecure
#       - --entrypoints.web.http.redirections.entrypoint.scheme=https
#       - --entrypoints.web.http.redirections.entrypoint.permanent=true
#       - --entrypoints.websecure.address=:443
#       - --entrypoints.debugging.address=:${DEBUG_CHROME_DEV_TOOLS_EXPOSED_PORT}
#
#       #Should the timeouts be too short for the debugging, then they can be increased here.
#       - --entryPoints.debugging.transport.respondingTimeouts.readTimeout=60
#       - --entryPoints.debugging.transport.respondingTimeouts.idleTimeout=180
#
#       - --providers.docker=true
#       - --providers.docker.exposedbydefault=false
#       - --providers.docker.network=public-network
#       - --providers.file.directory=/configuration/
#       - --providers.file.watch=true
#       - --accesslog
#       - --accesslog.fields.names.StartUTC=drop
#     ports:
#       - ${DEBUG_CHROME_DEV_TOOLS_EXPOSED_PORT}:2992
#       - ${PUBLIC_PORT_HTTP}:80
#       - ${PUBLIC_PORT_HTTPS}:443
#     networks:
#       - internal-network
#       - public-network

  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    command: --cleanup --schedule "0 0 0 * * *"
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

networks:
  internal-network:
    internal: true
  public-network:
